<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Teste de ValidaÃ§Ã£o - CorreÃ§Ãµes Implementadas</title>
  
  <!-- Script principal do GTM -->
  <script src="versao_atual_GTM.js"></script>
  
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .container { max-width: 800px; margin: 0 auto; }
    .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    .success { background-color: #d4edda; border-color: #c3e6cb; }
    .warning { background-color: #fff3cd; border-color: #ffeaa7; }
    .info { background-color: #d1ecf1; border-color: #bee5eb; }
    .code { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; }
    button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
    button:hover { background: #0056b3; }
    .log { background: #000; color: #0f0; padding: 10px; border-radius: 3px; font-family: monospace; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª Teste de ValidaÃ§Ã£o - CorreÃ§Ãµes Implementadas</h1>
    
    <div class="section info">
      <h3>ğŸ“‹ Objetivo do Teste</h3>
      <p>Este arquivo testa se as correÃ§Ãµes implementadas no <code>versao_atual_GTM.js</code> estÃ£o funcionando corretamente.</p>
    </div>

    <div class="section">
      <h3>ğŸ”§ Funcionalidades Testadas</h3>
      <ul>
        <li>âœ… Captura de cookies sem dupla codificaÃ§Ã£o</li>
        <li>âœ… Envio de eventos para GTM via dataLayer</li>
        <li>âœ… ConstruÃ§Ã£o de URL com parÃ¢metros</li>
        <li>âœ… Logs de debug em cada etapa</li>
        <li>âœ… InterceptaÃ§Ã£o de links</li>
      </ul>
    </div>

    <div class="section">
      <h3>ğŸ§ª Testes DisponÃ­veis</h3>
      <button onclick="testarCookies()">Testar Captura de Cookies</button>
      <button onclick="testarDataLayer()">Testar Envio para GTM</button>
      <button onclick="testarURLBuilder()">Testar Construtor de URL</button>
      <button onclick="testarInterceptacao()">Testar InterceptaÃ§Ã£o</button>
      <button onclick="limparLogs()">Limpar Logs</button>
    </div>

    <div class="section">
      <h3>ğŸ“Š Status dos Cookies</h3>
      <div id="cookieStatus"></div>
    </div>

    <div class="section">
      <h3>ğŸ”— URL Gerada</h3>
      <div id="urlGerada" class="code"></div>
    </div>

    <div class="section">
      <h3>ğŸ“ Logs de Debug</h3>
      <div id="logs" class="log"></div>
    </div>

    <div class="section warning">
      <h3>âš ï¸ Como Usar</h3>
      <ol>
        <li>Abra o DevTools (F12) e vÃ¡ para a aba Console</li>
        <li>Clique nos botÃµes de teste acima</li>
        <li>Verifique se as mensagens "Trinks Debug:" aparecem no console</li>
        <li>Monitore os logs na seÃ§Ã£o abaixo</li>
      </ol>
    </div>

    <div class="section success">
      <h3>âœ… Resultado Esperado</h3>
      <p>ApÃ³s executar os testes, vocÃª deve ver:</p>
      <ul>
        <li>Cookies sendo criados corretamente</li>
        <li>Eventos sendo enviados para o dataLayer</li>
        <li>URLs sendo construÃ­das com parÃ¢metros</li>
        <li>Logs detalhados em cada etapa</li>
      </ul>
    </div>
  </div>

  <script>
    // FunÃ§Ã£o para adicionar logs
    function adicionarLog(mensagem, tipo = 'info') {
      const logsDiv = document.getElementById('logs');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.innerHTML = `[${timestamp}] ${mensagem}`;
      logsDiv.appendChild(logEntry);
      logsDiv.scrollTop = logsDiv.scrollHeight;
    }

    // FunÃ§Ã£o para limpar logs
    function limparLogs() {
      document.getElementById('logs').innerHTML = '';
      adicionarLog('Logs limpos');
    }

    // FunÃ§Ã£o para testar captura de cookies
    function testarCookies() {
      adicionarLog('ğŸ§ª Testando captura de cookies...');
      
      // Simula a funÃ§Ã£o initCookies
      if (typeof window.initCookies === 'function') {
        window.initCookies();
        adicionarLog('âœ… FunÃ§Ã£o initCookies executada');
      } else {
        adicionarLog('âŒ FunÃ§Ã£o initCookies nÃ£o encontrada');
      }
      
      atualizarStatusCookies();
    }

    // FunÃ§Ã£o para testar dataLayer
    function testarDataLayer() {
      adicionarLog('ğŸ§ª Testando envio para dataLayer...');
      
      if (typeof window.captureFirstClick === 'function') {
        window.captureFirstClick();
        adicionarLog('âœ… FunÃ§Ã£o captureFirstClick executada');
        
        // Verifica se o evento foi enviado
        if (window.dataLayer && window.dataLayer.length > 0) {
          const ultimoEvento = window.dataLayer[window.dataLayer.length - 1];
          adicionarLog(`âœ… Evento enviado para dataLayer: ${ultimoEvento.event}`);
        } else {
          adicionarLog('âŒ Nenhum evento encontrado no dataLayer');
        }
      } else {
        adicionarLog('âŒ FunÃ§Ã£o captureFirstClick nÃ£o encontrada');
      }
    }

    // FunÃ§Ã£o para testar construtor de URL
    function testarURLBuilder() {
      adicionarLog('ğŸ§ª Testando construtor de URL...');
      
      if (typeof window.urlBuilder === 'function') {
        const url = window.urlBuilder();
        document.getElementById('urlGerada').textContent = url;
        adicionarLog(`âœ… URL gerada: ${url}`);
      } else {
        adicionarLog('âŒ FunÃ§Ã£o urlBuilder nÃ£o encontrada');
      }
    }

    // FunÃ§Ã£o para testar interceptaÃ§Ã£o
    function testarInterceptacao() {
      adicionarLog('ğŸ§ª Testando interceptaÃ§Ã£o...');
      
      if (typeof window.interceptAndRedirect === 'function') {
        adicionarLog('âš ï¸ Executando interceptAndRedirect (pode redirecionar)...');
        // Comentado para evitar redirecionamento durante teste
        // window.interceptAndRedirect();
        adicionarLog('âœ… FunÃ§Ã£o interceptAndRedirect disponÃ­vel');
      } else {
        adicionarLog('âŒ FunÃ§Ã£o interceptAndRedirect nÃ£o encontrada');
      }
    }

    // FunÃ§Ã£o para atualizar status dos cookies
    function atualizarStatusCookies() {
      const cookies = ['referrer', 'landingUrl', 'device', 'firstLandingUrl', 'firstLandingUrlDateTime', 'firstClickUrl', 'firstClickUrlDateTime'];
      const statusDiv = document.getElementById('cookieStatus');
      
      let html = '<table style="width:100%; border-collapse: collapse;">';
      html += '<tr><th>Cookie</th><th>Valor</th><th>Status</th></tr>';
      
      cookies.forEach(cookie => {
        const valor = getCookie(cookie);
        const status = valor ? 'âœ… Definido' : 'âŒ NÃ£o definido';
        const valorExibido = valor ? (valor.length > 50 ? valor.substring(0, 50) + '...' : valor) : 'N/A';
        
        html += `<tr style="border-bottom: 1px solid #ddd;">`;
        html += `<td style="padding: 5px;"><strong>${cookie}</strong></td>`;
        html += `<td style="padding: 5px; font-family: monospace;">${valorExibido}</td>`;
        html += `<td style="padding: 5px;">${status}</td>`;
        html += `</tr>`;
      });
      
      html += '</table>';
      statusDiv.innerHTML = html;
    }

    // FunÃ§Ã£o para obter cookie (simulada)
    function getCookie(name) {
      const cookies = document.cookie.split(';');
      for (let c of cookies) {
        c = c.trim();
        if (c.indexOf(name + '=') === 0) {
          return c.substring(name.length + 1);
        }
      }
      return null;
    }

    // InicializaÃ§Ã£o
    document.addEventListener('DOMContentLoaded', function() {
      adicionarLog('ğŸš€ PÃ¡gina carregada, iniciando testes...');
      atualizarStatusCookies();
      
      // Verifica se o script principal estÃ¡ carregado
      setTimeout(() => {
        if (typeof window.interceptAndRedirect === 'function') {
          adicionarLog('âœ… Script principal carregado com sucesso');
        } else {
          adicionarLog('âŒ Script principal nÃ£o encontrado');
        }
      }, 1000);
    });

    // Intercepta logs do console
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      
      // Filtra apenas logs do Trinks
      const mensagem = args.join(' ');
      if (mensagem.includes('Trinks Debug:')) {
        adicionarLog(`ğŸ” ${mensagem}`);
      }
    };
  </script>
</body>
</html>
